name: AI Site Updater (Issue Driven)

# â–¼â–¼â–¼ ã“ã“ãŒå¤‰ã‚ã‚Šã¾ã—ãŸï¼šãƒœã‚¿ãƒ³(workflow_dispatch)ã§ã¯ãªãã€Issueä½œæˆæ™‚(opened)ã«å‹•ã â–¼â–¼â–¼
on:
  issues:
    types: [opened]

permissions:
  contents: write
  pull-requests: write
  issues: write 

jobs:
  update_content:
    # ã‚¿ã‚¤ãƒˆãƒ«ã« [Update] ãŒå…¥ã£ã¦ã„ã‚‹æ™‚ã ã‘å‹•ãï¼ˆèª¤çˆ†é˜²æ­¢ï¼‰
    if: startsWith(github.event.issue.title, 'Up')
    runs-on: ubuntu-latest
    steps:
      - name: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
        uses: actions/checkout@v4

      - name: Pythonã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          pip install --upgrade pip
          pip install --upgrade google-generativeai

      # â–¼â–¼â–¼ ã“ã“ãŒå¤‰ã‚ã‚Šã¾ã—ãŸï¼šå…¥åŠ›æ¬„ã§ã¯ãªãã€Issueã®ã€Œæœ¬æ–‡(body)ã€ã‚’æŒ‡ç¤ºã¨ã—ã¦æ¸¡ã™ â–¼â–¼â–¼
      - name: Geminiã§HTMLä¿®æ­£
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python update_site.py "${{ github.event.issue.body }}"

      - name: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Fix: Issue #${{ github.event.issue.number }}"
          branch: ai-update-issue-${{ github.event.issue.number }}
          title: "ğŸ¤– AIæ›´æ–°ä¾é ¼ (from Issue #${{ github.event.issue.number }})"
          body: |
            Issue #${{ github.event.issue.number }} ã®æŒ‡ç¤ºã«åŸºã¥ãä¿®æ­£æ¡ˆã§ã™ã€‚
            æ‰¿èª(Merge)ã™ã‚‹ã¨æœ¬ç•ªã«åæ˜ ã•ã‚Œã¾ã™ã€‚
            Closes #${{ github.event.issue.number }}
          delete-branch: true