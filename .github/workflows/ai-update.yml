name: AI Site Updater

on:
  workflow_dispatch:
    inputs:
      instruction:
        description: 'ä¿®æ­£å†…å®¹ã‚’å…¥åŠ› (ä¾‹: ãŠçŸ¥ã‚‰ã›ã®æ—¥ä»˜ã‚’æ›´æ–°ã—ã¦)'
        required: true

permissions:
  contents: write
  pull-requests: write

jobs:
  update_content:
    runs-on: ubuntu-latest
    steps:
      - name: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
        uses: actions/checkout@v4

      # â–¼â–¼â–¼ ä¿®æ­£ç®‡æ‰€1: Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ 3.11 ã«å¤‰æ›´ â–¼â–¼â–¼
      - name: Pythonã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.11' 

      # â–¼â–¼â–¼ ä¿®æ­£ç®‡æ‰€2: --upgrade ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¦æœ€æ–°ç‰ˆã‚’å…¥ã‚Œã‚‹ â–¼â–¼â–¼
      - name: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: pip install --upgrade google-generativeai

      - name: Geminiã§HTMLä¿®æ­£
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python update_site.py "${{ inputs.instruction }}"

      - name: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ (ç¢ºèªç”¨)
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "AIã«ã‚ˆã‚‹æ›´æ–°: ${{ inputs.instruction }}"
          branch: ai-update-branch
          title: "ğŸ¤– AIæ›´æ–°ä¾é ¼: ${{ inputs.instruction }}"
          body: |
            AIã«ã‚ˆã‚‹ä¿®æ­£ææ¡ˆã§ã™ã€‚
            ã€ŒFiles changedã€ã‚¿ãƒ–ã§å¤‰æ›´ç®‡æ‰€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
            å•é¡Œãªã‘ã‚Œã° **Merge pull request** ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨æœ¬ç•ªå…¬é–‹ã•ã‚Œã¾ã™ã€‚
          delete-branch: true